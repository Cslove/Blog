# Vue3.0 å°é²œ

å›½åº†æœŸé—´Vue3.0çš„æºç å‡ºä¸–ï¼Œå€Ÿç€å›½åº†å½’æ¥åˆ’æ°´ä¸€å‘¨çš„æ—¶é—´äº†è§£äº†3.0çš„ä¸€äº›ä¸»è¦æ–°åŠŸèƒ½ä¸æºç çš„æ¢ç´¢ï¼Œåœ¨æ­¤åšä¸ªå°æ€»ç»“ï½

## æ€æ ·å…¥æ‰‹çœ‹æºç 
å°†é¡¹ç›®å…‹éš†åˆ°æœ¬åœ°`git clone git@github.com:vuejs/vue-next.git`ï¼Œé¦–å…ˆæ³¨æ„åˆ°readmeæœ€åå†™çš„[Contributing Guide](https://github.com/vuejs/vue-next/blob/master/.github/contributing.md)ï¼Œæœæ–­ç‚¹è¿›å»çœ‹åˆ°`Development Setup` éƒ¨åˆ†ï¼Œè¿™é‡Œä¼šæœ‰é¡¹ç›®çš„å¼€å‘è®¾ç½®ä»‹ç»ï¼Œç”¨`yarn`å‘½ä»¤å®‰è£…ç›¸å…³ä¾èµ–ä¹‹åï¼Œåœ¨çœ‹package.jsonçš„scriptsè„šæœ¬å‘½ä»¤éƒ½æœ‰å“ªäº›ï¼Œå› ä¸ºé¡¹ç›®åˆšå‡ºæ¥ï¼Œæºç è¿˜æ˜¯å¾ˆæ¸…æ™°çš„ï¼ŒContributing Guideä¸­ä¹Ÿæœ‰ä»‹ç»è¿™äº›è„šæœ¬çš„ä½œç”¨ï¼Œå…¶ä¸­æ•´ä¸ªé¡¹ç›®æ¶‰åŠåˆ°çš„ç›¸å…³å·¥å…·ï¼š
- æ•´ä¸ªé¡¹ç›®å®Œå…¨åŸºäºTypeScriptå¼€å‘
- Rollupä½œä¸ºæ‰“åŒ…å·¥å…·
- jestç”¨æ¥å•å…ƒæµ‹è¯•
- lernaæ˜¯monorepoï¼Œè¿›è¡Œå¤šä»“åº“ç®¡ç†

å¯¹è¿™äº›å¼€å‘å·¥å…·ğŸ”§æœ‰ä¸€äº›äº†è§£ï¼Œå¯¹çœ‹æºç å¯ä»¥èµ·åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœï¼Œéƒ½ä¸äº†è§£çš„è¯å¯¹çœ‹æºç ä¹Ÿæ²¡å¤šå¤§é—®é¢˜

åœ¨å¤§è‡´çœ‹ä¸‹é¡¹ç›®ç›®å½•ç»“æ„ï¼Œscriptsç›®å½•ä¸‹ä¸»è¦æ”¾äº†ç›¸å…³æ‰“åŒ…å‘½ä»¤èµ°çš„ç¨‹åºï¼Œpackagesç›®å½•æ˜¯å„ä¸ªç‹¬ç«‹çš„æ ¸å¿ƒæºç åŒ…ï¼Œå…¶ä¸­çš„å„ä¸ªåŒ…ä¾èµ–é€šè¿‡ [lerna](https://github.com/lerna/lerna) ç®¡ç†ï¼ŒContributing Guideä¸­å¯ä»¥çœ‹åˆ°scriptsè„šæœ¬å‘½ä»¤çš„å«ä¹‰ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ`yarn dev`ï¼Œä»æ§åˆ¶å°æ‰“å°çš„ä¿¡æ¯
```
bundles packages/vue/src/index.ts â†’ packages/vue/dist/vue.global.js...
```
ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸ªå‘½ä»¤é»˜è®¤æ˜¯ä»¥packages/vue/src/index.tsä¸‹çš„æ–‡ä»¶ä¸ºæ‰“åŒ…å…¥å£ï¼Œå¹¶æ‰“åŒ…è‡³packages/vue/dist/ä¸‹çš„vue.global.jsæ–‡ä»¶ä¸‹ï¼Œæ³¨æ„æ–‡ä»¶åä¸­ï¼š
- `global`: è¡¨ç¤ºæ‰“åŒ…çš„æ–‡ä»¶å¯ç›´æ¥åœ¨`<script>`ä¸­çš„srcå±æ€§ç›´æ¥å¼•å…¥
- `esm`: æ˜¯åœ¨ä¾èµ–äºæ‰“åŒ…å™¨çš„æ¨¡å—ä¸­ä½¿ç”¨import
- `esm-browser`: åœ¨æµè§ˆå™¨çš„ESæ¨¡å—ä¸­ä½¿ç”¨`<script type="module">`
- `cjs`: nodejsä¸­é€šè¿‡`require()`ä½¿ç”¨

æ‰§è¡Œ`yarn dev`å‘½ä»¤åå³å¯åœ¨packages/vue/dist/ç›®å½•ä¸‹çœ‹åˆ°vue.global.jsæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥ç›´æ¥åœ¨`<script>`è„šæœ¬ä¸­å¼•å…¥ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†æˆ‘ä»¬å»è°ƒè¯•æºç ã€‚

å…³äºè°ƒè¯•æºç çš„æ–¹å¼ï¼Œæˆ‘ä¸ªäººå¾ˆå€¾å‘äºç›´æ¥åœ¨vscodeä¸­è¿›è¡Œè°ƒè¯•ï¼Œå¯ä»¥çœ‹æˆ‘å†™çš„å¦ä¸€ç¯‡è¶…è¯¦ç»†è®²è§£æ€æ ·åœ¨vscodeä¸­è°ƒè¯•æºç çš„æ–‡ç« ï¼Œ[åœ¨è¿™é‡Œ](https://github.com/Cslove/Blog/blob/master/learn-debugging-in-vscode.md)

å›åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªindex.htmlæ–‡ä»¶å¹¶å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼Œ
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <div id="app"></div>
    <script src="packages/vue/dist/vue.global.js"></script>
    <script>
        console.log(Vue)
    </script>
</body>
</html>
```
é€šè¿‡`<script>`æ ‡ç­¾ç›´æ¥å¼•å…¥æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªscriptæ ‡ç­¾å†…ç›´æ¥æ‰“å°Vueå…¨å±€å˜é‡ï¼Œå°†æ­¤æ–‡ä»¶ä»æµè§ˆå™¨æ‰“å¼€åœ¨æ§åˆ¶å°å°±å¯ä»¥çœ‹åˆ°æ‰“å°ä¿¡æ¯

é€šè¿‡ä¸Šé¢æ§åˆ¶å°æ‰“å°çš„`Vue`ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°`Vue`å·²ç»ä¸åœ¨æ˜¯ä¸ª`constructor`ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ ä¸èƒ½åœ¨è¿™æ ·ä½¿ç”¨`new Vue(options)`ï¼Œå®ƒå°±åƒreactä¸€æ ·æš´éœ²äº†ä¼—å¤šapiï¼Œå…·ä½“å¯ä»¥çœ‹è¿™ä¸ª [rfc](https://github.com/vuejs/rfcs/blob/master/active-rfcs/0004-global-api-treeshaking.md) 

> *ä»¥ä¸‹å†…å®¹åªé’ˆå¯¹Vue3.0çš„æ–°åŠŸèƒ½æ¢ç´¢ï¼Œå…¶ä¸­çš„ä¸€äº›æ–°apiæœ€å¥½çœ‹ä¸‹æ­¤ [Composition API RFC](https://vue-composition-api-rfc.netlify.com/#summary)*

åœ¨ä¸Šé¢çš„index.htmlæ–‡ä»¶ä¸‹çš„ç¬¬äºŒä¸ª`<script>`å—ç®€å•å†™å¦‚ä¸‹ä»£ç ï¼š
```js
const {
    reactive,
    computed,
    watch,
} = Vue
var app = Vue.createApp().mount({
    setup() {
        const state = reactive({
            count: 0,
            double: computed(() => state.count * 2)
        })
        function increment() {
            state.count++
        }
        watch(() => {
            console.log(state.double)
        })
        return {
            state,
            increment,
        }
    },
    template: `<div>{{ state.count }}|{{ state.double }}</div>
    <button @click="increment">+ 1</button>`,
}, '#app')
```
ä¿å­˜æ–‡ä»¶åï¼Œåˆ·æ–°æµè§ˆå™¨å¯çœ‹åˆ°å°±æ˜¯ä¸€ä¸ªå°æŒ‰é’®ç‚¹å‡»åä¼šæœ‰+1çš„å°åŠŸèƒ½æ•ˆæœã€‚åœ¨çœ‹ä¸Šé¢çš„ä»£ç æ˜¯ä¸ä¹‹å‰çš„å†™æ³•å®Œå…¨ä¸åŒçš„å½¢å¼ï¼Œè¿™å°±æ˜¯å®˜æ–¹ç§°ä¸ºCompositionçš„apiï¼Œæˆ‘è§‰å¾—å®ƒä¸»è¦ä»£è¡¨äº†è¿™å‡ ä¸ªç›®çš„ï¼š

- é€»è¾‘å¤ç”¨
- ä»£ç é‡ç»„ç»‡
- æ›´å¥½çš„ç±»å‹æ¥å£

ä¹‹å‰çš„Vueå†™æ³•ä¼šè¦åœ¨å„ä¸ªç”Ÿå‘½å‘¨æœŸä¸åœçš„è·³è½¬æŸ¥çœ‹é€»è¾‘ï¼Œéšç€ä¸šåŠ¡éœ€æ±‚çš„å¢å¤šï¼Œé€»è¾‘ä»£ç ä¹Ÿè¶Šæ¥è¶Šåˆ†æ•£ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†è¶Šæ¥è¶Šéš¾ä»¥å¤ç”¨å’Œç»´æŠ¤çš„é—®é¢˜ã€‚è€Œä¸”ä¹‹å‰çš„ç‰ˆæœ¬åœ¨è¶Šæ¥è¶Šå¤§é¡¹ç›®ä¸Štypescriptçš„æ”¯æŒåº¦ä¹Ÿä¸æ˜¯å¾ˆé«˜ï¼Œç”±äºVueæœ¬è´¨åœ¨thisçš„è®¾è®¡é—®é¢˜ä¸Šï¼Œthisæ˜¯æŒ‡å‘ç»„ä»¶å®ä¾‹ä¸Šçš„ï¼Œè€Œä¸”methodsä¸‹çš„å‡½æ•°ä¸­çš„thisä¹Ÿæ˜¯æŒ‡å‘ç»„ä»¶å®ä¾‹ï¼Œå°±å¯¼è‡´ç±»å‹è®¾è®¡çš„å¤æ‚åº¦å¾ˆé«˜ï¼ŒVue 3.0å°±æ˜¯è§£å†³è¿™äº›é—®é¢˜çš„ã€‚

ç†Ÿæ‚‰reactçš„äººçœ‹åˆ°ä¸Šé¢çš„ä»£ç å¯èƒ½ä¼šè¯´ï¼Œè¿™ä¸å°±æ˜¯react hookså˜›ï¼Œæ˜¯çš„ï¼Œç¡®å®å€Ÿé‰´äº†react hook ç›¸åŒçš„é€»è¾‘å¤ç”¨ç›®çš„ã€‚ä½†ä¸hookåˆæœ‰é‡å¤§çš„ä¸åŒï¼š

- `setup()`å‡½æ•°åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œå®ƒåœ¨`beforeCreate`ä¹‹åï¼Œ`created`hookä¹‹å‰è°ƒç”¨
- react hooksä¼šå¾ˆåœ¨æ„è°ƒç”¨é¡ºåºå¹¶ä¸”ä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ä¸­è°ƒç”¨ï¼Œè€Œåœ¨`setup`ä¸­çš„Composition APIä¸åœ¨ä¹
- Vueä¼šè‡ªåŠ¨è¿½è¸ªæ•°æ®çš„æ›´æ–°ï¼Œä¸åƒuseEffecté‚£æ ·æ›´æ–°éœ€è¦ä¼ å…¥è¦ä¾èµ–çš„æ•°æ®æ•°ç»„

æ˜¾ç„¶ï¼Œæ— è®ºæ€æ ·ä¸åŒï¼ŒVueè¿˜æ˜¯å—åˆ°äº†react hookçµæ„Ÿè€Œæ¥

åœ¨å›åˆ°ä¸Šé¢çš„ä»£ç ï¼Œä¸ä¹‹å‰çš„å½¢å¼ä¸åŒï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦è°ƒç”¨`createApp()`æ–¹æ³•åˆ›å»ºä¸€ä¸ªappå®ä¾‹ï¼Œç„¶åè°ƒç”¨å®ä¾‹çš„`mount(rootComponent, rootContainer, rootProps)`æ–¹æ³•ï¼Œå…¶æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä¸ä¹‹å‰çš„`new Vue(options)`ä¸­çš„optionsä¸€æ ·çš„æ ¹ç»„ä»¶å®ä¾‹å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åº”ç”¨è¦æŒ‚è½½çš„domèŠ‚ç‚¹ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç»„ä»¶çš„é»˜è®¤props

`setup()`æ˜¯ç»„ä»¶çš„ä¸€ä¸ªæ–°å±æ€§ï¼Œå®ƒä¸»è¦ç”¨äºæ‰§è¡Œæ‰€æœ‰çš„Composition APIçš„å…¥å£ï¼Œæ˜¯çš„ï¼Œæ‰€æœ‰é€»è¾‘éƒ½å¯ä»¥å†™åˆ°è¿™ä¸ªå‡½æ•°é‡Œï¼ŒVueä¹Ÿç›¸åº”çš„æš´éœ²å‡ºäº†æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œ`onMounted()ã€onUpdated()ã€onXXX()...`è¿™å¯èƒ½ä¼šå¯¼è‡´setupå‡½æ•°ä¼šå¾ˆè†¨èƒ€ï¼Œä½†å…¶å®è¿™äº›é€»è¾‘å°±å¯ä»¥ä¸“é—¨æå–å‡ºæ¥ä»¥ä¾›å…¶ä»–åœ°æ–¹å¤ç”¨ï¼Œè¿™ä¹Ÿå°±æ˜¯Compositioné€»è¾‘å¤ç”¨çš„ç›®çš„

setupå‡½æ•°å†…éƒ¨ä½¿ç”¨`reactive()`æ–¹æ³•åˆå§‹åŒ–äº†ä¸€ä¸ªstateå¯¹è±¡ï¼Œç»è¿‡`reactive()`æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªè¢«Proxyä»£ç†è¿‡çš„å¯¹è±¡ï¼ˆåé¢ä¼šè®¨è®ºå†…éƒ¨çš„å®ç°åŸç†ï¼‰ï¼Œ`computed()`æ–¹æ³•ç±»ä¼¼ä¸åŸæ–¹å¼çš„ä½¿ç”¨ï¼Œä½†åˆæœ‰äº›å¾®ä¸åŒï¼Œcomputedæ–¹æ³•å®é™…è¿”å›çš„æ˜¯ä¸ªrefså¯¹è±¡ï¼Œç±»ä¼¼ä¸reactçš„useRef()ï¼Œ`{ value: xx }`ï¼Œéœ€è¦æ‹¿åˆ°é‡Œé¢çš„valueå€¼æ‰èƒ½æ‹¿åˆ°æœ€ç»ˆçš„å€¼ï¼š
```js
const double = computed(() => state.count)

watch(() => {
    console.log(double.value) // 0
    console.log(double) // ä¸€ä¸ªrefå¯¹è±¡
})
```
